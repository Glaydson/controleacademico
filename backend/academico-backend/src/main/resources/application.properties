# ===================================================================
# SERVER CONFIGURATION
# ===================================================================
quarkus.http.port=8081
quarkus.http.host=0.0.0.0

# ===================================================================
# DATABASE CONFIGURATION (Development & Production Profile)
# ===================================================================
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=jdbc:postgresql://backend-db:5432/academico_db
quarkus.datasource.username=academico_user
quarkus.datasource.password=academico_pass
quarkus.hibernate-orm.database.generation=update
quarkus.hibernate-orm.log.sql=true

# ===================================================================
# OIDC - KEYCLOAK CONFIGURATION
# ===================================================================
quarkus.oidc.auth-server-url=${KEYCLOAK_URL:http://keycloak:8080/realms/controle-academico}
quarkus.oidc.client-id=academico-backend
quarkus.oidc.credentials.secret=dm3cpaNsboxZg6PRGyiObpqO6K3SjOgw
quarkus.oidc.application-type=service
# For development, you might need to disable TLS verification if Keycloak uses self-signed certs
# quarkus.tls.trust-all=true

# ===================================================================
# SWAGGER UI / OPENAPI CONFIGURATION
# ===================================================================
# This makes the Swagger UI available in production.
# For development only, you would use %dev.quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.always-include=true
quarkus.smallrye-openapi.path=/openapi
quarkus.swagger-ui.path=/swagger-ui

# ===================================================================
# KEYCLOAK ADMIN CLIENT CONFIGURATION
# ===================================================================
# This client is used by the backend to communicate with Keycloak's Admin API
quarkus.keycloak.admin-client.server-url=${KEYCLOAK_URL:http://keycloak:8080}
quarkus.keycloak.admin-client.realm=controle-academico
quarkus.keycloak.admin-client.client-id=backend-admin-client
quarkus.keycloak.admin-client.client-secret=wznY6RqvIqnLIXAwx1wdPumdPZLeyJDp
# Use 'client_credentials' grant type for server-to-server communication
quarkus.keycloak.admin-client.grant-type=client_credentials

# ===================================================================
# HTTP SECURITY POLICIES
# IMPORTANT: Rules are evaluated in the order they appear. First match wins.
# ===================================================================

# 1. Publicly accessible paths (Swagger, Health Checks)
quarkus.http.auth.permission.public.paths=/q/health,/q/health/*,/openapi,/swagger-ui/*
quarkus.http.auth.permission.public.policy=permit

# 2. API specific paths with role-based access
quarkus.http.auth.permission.api.paths=/cursos/*,/api/users/*
quarkus.http.auth.permission.api.policy=require-roles

# 3. Default rule: Deny all other paths by default to ensure security.
# Any new endpoint will be secure by default.
quarkus.http.auth.permission.default.paths=/*
quarkus.http.auth.permission.default.policy=deny

# Policy definitions used by the rules above
quarkus.http.auth.policy.require-roles.roles-allowed=COORDENADOR,ALUNO,PROFESSOR,ADMIN

# ===================================================================
# CORS CONFIGURATION
# ===================================================================
quarkus.http.cors=true
quarkus.http.cors.origins=http://localhost:4200,http://frontend:4200
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS

# ===================================================================
# LOGGING CONFIGURATION
# ===================================================================
quarkus.log.level=INFO
quarkus.log.category."com.glaydson".level=DEBUG

# ===================================================================
# TEST PROFILE CONFIGURATION
# These properties are ONLY active when running tests (`mvn test`)
# ===================================================================
%test.quarkus.http.port=8082
# Use an in-memory H2 database for tests to isolate them
%test.quarkus.datasource.db-kind=h2
%test.quarkus.datasource.jdbc.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1
%test.quarkus.hibernate-orm.database.generation=drop-and-create
# Disable authentication for tests unless specifically testing security
%test.quarkus.security.test-mode=true
